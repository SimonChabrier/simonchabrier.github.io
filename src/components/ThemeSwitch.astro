---
/**
 * ThemeSwitch Component
 *
 * Sélecteur de thème (System, Dark, Light) avec persistance dans localStorage.
 * Utilise les utilitaires centralisés pour la gestion du thème et les traductions.
 *
 * @component
 */

import { t } from "@/utils/i18n";
import Theme from "@/icons/themeSwitch.astro";

const { locale } = Astro.props;

// Récupérer les textes traduits via le système i18n
const changeText = t("common:theme.change", { lng: locale });
const systemText = t("common:theme.system", { lng: locale });
const darkText = t("common:theme.dark", { lng: locale });
const lightText = t("common:theme.light", { lng: locale });
---

<div class="no-print inline-flex items-center p-2">
  <div class="group/theme flex items-center gap-2">
    <label
      for="themeSwitch"
      aria-label={changeText}
      aria-controls="themeSwitch"
      class="flex items-center gap-1 text-sm font-medium leading-6 text-skin-base transition-transform ease-in-out group-hover/theme:rotate-45"
    >
      <Theme />
      <span class="sr-only">{changeText}</span>
    </label>
    <select
      id="themeSwitch"
      name="themeSwitch"
      class="block w-full rounded-md border-0 py-1.5 pl-3 pr-10 text-skin-base ring-1 ring-inset ring-skin-muted focus:ring-2 focus:ring-skin-hue dark:text-white sm:text-sm sm:leading-6"
    >
      <option value="system" class="dark:text-white">{systemText}</option>
      <option value="dark" class="dark:text-white">{darkText}</option>
      <option value="light" class="dark:text-white">{lightText}</option>
    </select>
  </div>

  <style>
    .dark select option {
      color: white !important;
    }
  </style>

  <script>
    import { initializeTheme, updateTheme } from "@/utils/theme";
    import type { Theme } from "@/utils/theme";

    // Récupérer l'élément select
    const select = document.getElementById("themeSwitch") as HTMLSelectElement;

    // Initialiser le thème au chargement de la page
    initializeTheme(select);

    // Écouter les changements de thème
    select.addEventListener("change", (event: Event) => {
      const target = event.target as HTMLSelectElement;
      updateTheme(target.value as Theme);
    });
  </script>
</div>
